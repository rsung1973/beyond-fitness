
@using System.IO
@using System.Linq.Expressions

@using WebHome.Helper
@using WebHome.Models.Locale
@using WebHome.Models.ViewModel
@using WebHome.Models.DataEntity
@using WebHome.Controllers
@{

    ModelStateDictionary _modelState;
    ModelSource<UserProfile> models;
    int partialCount;
    if(TempData["PartialCount"]==null)
    {
        partialCount = 0;
    }
    else
    {
        partialCount = (int)TempData["PartialCount"];
    }
    String _viewID = $"searchLearner_{partialCount++}";
    TempData["PartialCount"] = partialCount;

    _modelState = (ModelStateDictionary)ViewBag.ModelState;
    models = ((SampleController<UserProfile>)ViewContext.Controller).DataSource;
}
<input type="text" id="@(_viewID)" class="form-control" name="userName" placeholder="搜尋學生..." />
<span class="input-group-addon cursor" onclick="searchLearner($('#@(_viewID)').val());">
    <i class="zmdi zmdi-search"></i>
    <script>
        $(function () {
            $('#@(_viewID)').keypress(function (event) {
                var event = event || window.event;
                var userName = $(event.target).val();
                var keycode = (event.keyCode ? event.keyCode : event.which);
                if (keycode == '13') {
                    searchLearner(userName);
                }
            });
        });

        function searchLearner(param) {
            clearErrors();
            if (param.length < 2) {
                        swal({
                            title: "Opps！",
                            text: "你忘了學生的姓名嗎？!(至少2個中、英文字)",
                            type: "warning",
                            showCancelButton: false,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "重新輸入!",
                            closeOnConfirm: true
                        }, function () {

                        });
            } else {
                        showLoading();
                $.post('@((String)ViewBag.SearchAction)', { 'userName': param }, function (data) {
                            hideLoading();
                            if ($.isPlainObject(data)) {
                                if (data.result) {
                                    swal(data.message);
                                } else {
                                    swal({
                                        title: "Opps！",
                                        text: "你確定有這個學生？!",
                                        type: "warning",
                                        showCancelButton: false,
                                        confirmButtonColor: "#DD6B55",
                                        confirmButtonText: "重新輸入!",
                                        closeOnConfirm: true
                                    }, function () {

                                    });
                                }
                            } else {
                                $(data).appendTo($('body'));
                            }
                        });
                    }
        }

    </script>
</span>



