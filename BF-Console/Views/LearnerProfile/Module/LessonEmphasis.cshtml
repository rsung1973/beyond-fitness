@using System.IO
@using System.Linq.Expressions

@using WebHome.Helper
@using WebHome.Models.Locale
@using WebHome.Models.ViewModel
@using WebHome.Models.DataEntity
@using WebHome.Controllers
@{

    ModelStateDictionary _modelState;
    ModelSource<UserProfile> models;
    LessonTime _model;

    _modelState = (ModelStateDictionary)ViewBag.ModelState;
    models = ((SampleController<UserProfile>)ViewContext.Controller).DataSource;
    _model = (LessonTime)this.Model;
}
@{
    UserProfile learner = (UserProfile)ViewBag.Learner;
    var plan = _model.AssertTrainingPlan(models, UID: learner.UID);
    var execution = plan.TrainingExecution;
    bool viewOnly = (bool?)ViewBag.ViewOnly == true ? true : false;
    bool isModal = (bool?)ViewBag.IsModal == true ? true : false;
}
<a href="javascript:@(isModal ? "void(0)" : $"$global.editEmphasis('{HttpUtility.JavaScriptStringEncode(execution.Emphasis)}')");">
    <span id="emphasis">@(execution.Emphasis ?? "重點一片空，學生要來踹你了...")</span>
    <i class="zmdi livicon-evo" data-options="name: pencil.svg; size: 30px; style: original; strokeStyle:round; strokeColor:#052333; strokeWidth:2px; autoPlay:true"></i>
</a>
@if (viewOnly != true)
{
    <script>
        $(function () {
            //編輯上課重點
            $global.editEmphasis = function (defaultValue) {
                swal({
                    title: "上課重點",
                    text: "",
                    type: "input",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "確定, 不後悔",
                    cancelButtonText: "不, 點錯了",
                    closeOnConfirm: false,
                    animation: "slide-from-top",
                    inputPlaceholder: "請輸入20個中英文字",
                    inputValue: defaultValue
                }, function (inputValue) {
                    if (inputValue === false)
                        return false;
                    if (inputValue === "") {
                        swal.showInputError("你忘了輸入文字嗎!?");
                        return false
                    }
                    commitEmphasis(inputValue);
                });
            };

            function commitEmphasis(emphasis) {
                showLoading();
                $.post('@Html.Raw(Url.Action("CommitEmphasis", "Training"))', { 'keyID': '@(plan.ExecutionID.EncryptKey())', 'emphasis': emphasis }, function (data) {
                    hideLoading();
                    if ($.isPlainObject(data)) {
                        if (data.result) {
                            swal("Nice!", "You wrote: " + emphasis, "success");
                            $('#emphasis').text(emphasis);
                        } else {
                            swal({
                                title: "Opps！",
                                text: data.message,
                                type: "warning",
                                showCancelButton: false,
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "重新輸入!",
                                closeOnConfirm: true
                            }, function () {

                            });
                        }
                    } else {
                        $(data).appendTo($('body'));
                    }
                });
            }

        });
    </script>
}
else
{
    <script>
        $(function () {
            //編輯上課重點
            $global.editEmphasis = function () {
                swal("是不是忘了重新了解學生？", "了解學生後編輯的課表才會更完美喔！");
            };
        });
    </script>
}